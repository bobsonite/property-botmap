:root{
  --bg:#ffffff;
  --text:#111827;
  --muted:#6b7280;
  --card:#ffffff;
  --card-border:#e5e7eb;
  --card-hover:#f6f9ff;
  --popup-bg:#ffffff;
  --popup-text:#111827;
  --chip-bg:#f3f4f6;
  --chip-text:#111827;
  --accent:#6d28d9;   /* deep purple */
  --accent-2:#a855f7; /* keep lighter violet as a secondary */
  --panel-bg:#faf5ff;              /* very light lilac */
  --panel-border-strong:#e4ddff;   /* slightly stronger than card border */

  /* Rings */
  --ring-500: rgba(109,40,217,.10);
  --ring-1000: rgba(109,40,217,.07);
  --ring-2000: rgba(109,40,217,.05);
  --ring-stroke:#6d28d9;
  --ring-label:#1f2937;
  --ring-halo:#ffffff;

  /* Amenity / Service tints */
  --amen-border:#10b981;  /* emerald-500 */
  --amen-bg:#10b9811a;
  --serv-border:#8b5cf6;  /* violet-500 */
  --serv-bg:#8b5cf61a;

  /* Tooltip */
  --tt-bg: var(--card);
  --tt-text: var(--text);
  /* soft purple border + slightly richer shadow */
  --tt-border: rgba(168, 85, 247, .55);      /* uses your accent-2 purple */
  --tt-shadow: 0 8px 20px rgba(88, 28, 135, .20);
}

html, body { margin:0; height:100%; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:var(--bg); color:var(--text); }
.wrap { display:flex; height:100vh; position:relative; }

#botPane { width:28vw; min-width:320px; overflow:auto; }
#map     { flex:1; position:relative; }
#listPane{
  width:25vw;
  min-width:300px;
  max-width:480px;
  overflow:auto;
  border-left:1px solid var(--panel-border-strong);
  background:var(--panel-bg);
}

/* topbar */
.topbar {
  position:absolute; right:12px; top:12px; z-index:2;
  background:var(--card); color:var(--text);
  padding:6px 8px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.08);
  display:flex; align-items:center; gap:8px; border:1px solid var(--card-border);
  font-size:12px;
}
.pill{
  background:var(--chip-bg);
  color:var(--chip-text);
  padding:2px 10px;
  border-radius:999px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:12px;
  line-height:1;
  min-height:26px;
  white-space:nowrap;
}

/* markers */
.pin{
  width:34px;
  height:34px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  background:var(--card);
  border:2px solid var(--card-border);
  box-shadow:0 2px 10px rgba(0,0,0,.22);
  font-size:20px;
  transition:
    transform .12s ease,
    box-shadow .12s ease,
    background .12s ease,
    border-color .12s ease;
}

/* Stacking: properties above POIs above universities
   + soft type-specific tints */
.pin--prop{
  z-index:3;
  background:#f5f3ff;               /* soft lilac */
  border-color:var(--accent-2);     /* your purple */
}
.pin--poi{
  z-index:2;
  background:#ecfdf5;               /* pale green for POIs */
  border-color:#10b981;             /* emerald */
}
.pin--uni{
  z-index:1;
  background:#fff7ed;               /* warm tint for campuses */
  border-color:#f97316;             /* orange */
}

/* Hover emphasis shared */
.pin.is-hot{
  transform:scale(1.1);
  box-shadow:0 3px 14px rgba(88, 28, 135, .35);
}

/* filter bar */
#filtersBar{
  position:sticky;
  top:0;
  z-index:1;
  background:var(--panel-bg); /* solid, no see-through */
  border-bottom:1px solid var(--card-border);
}
.filters-row{
  display:flex;
  align-items:center;
  flex-wrap:wrap;
  gap:8px;
  padding:10px 12px;
}
.filters-left{
  display:flex;
  align-items:center;
  gap:8px;
}
.filters-row-secondary{
  border-bottom:1px dashed var(--card-border);
  padding-bottom:6px;
  margin-bottom:-4px; /* tighten vertical spacing slightly */
}
.filters-title{ font-weight:600; }
.spacer{ flex:1; }
.count-badge{
  background:var(--accent);
  color:#ffffff;
  font-size:12px;
  padding:4px 14px;
  border-radius:999px;
  border:1px solid var(--accent);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-height:28px;
  white-space:nowrap;
  font-weight:600;
}
.filters-section{ padding:8px 12px 10px; }
.filters-label{ font-size:12px; color:var(--muted); display:block; margin-bottom:6px; }
.filters-chips{ display:flex; gap:6px; flex-wrap:wrap; }
.filter-chip{
  font-size:12px; border:1px solid var(--card-border); background:var(--chip-bg);
  color:var(--chip-text); border-radius:999px; padding:4px 8px; cursor:pointer; user-select:none;
}
.filter-chip.is-on{ outline:2px solid #10b98155; background:#10b9811a; }

/* compact ghost pill */
.pill-ghost{
  background:transparent; color:var(--text);
  border:1px solid var(--card-border);
}

/* collapsible body */
.filters-body{ padding:8px 12px 10px; border-top:1px solid var(--card-border); }
#filtersBar.collapsed .filters-body{ display:none; }
#filtersToggle{ min-width:64px; }

/* saved drawer (inline, hidden until opened) */
.saved-panel{ padding:10px 12px; border-top:1px dashed var(--card-border); background:var(--card); }
.saved-panel h4{ margin:0 0 8px; font-size:13px; color:var(--muted); }
.saved-item{ display:flex; justify-content:space-between; align-items:center; gap:8px; padding:6px 0; font-size:13px; }
.saved-item a{ text-decoration:none; }
.saved-item .rm{ border:none; background:transparent; color:#9ca3af; cursor:pointer; }

/* cards */
.card{
  position:relative;
  background:var(--card); color:var(--text); margin:12px; padding:14px; border-radius:12px;
  box-shadow:0 1px 8px rgba(0,0,0,0.06);
  transition:transform .12s ease, background .12s ease, outline .12s ease;
  border:1px solid var(--card-border); cursor:pointer;
}
.card:hover{ transform:translateY(-1px); }
.card.is-active{
  outline:none;
  border:2px solid var(--accent);
  background:var(--card-hover);
  box-shadow:0 0 0 1px rgba(109,40,217,0.12);
}
.card h3{ margin:0 0 4px; font-size:15px; }
.meta{ color:var(--muted); font-size:12px; }
.addr{
  color:var(--text);
  font-size:13px;
  margin-top:6px;
  font-weight:500;
}

/* Property description: 3-line teaser by default */
.desc{
  color:var(--text);
  font-size:13px;
  margin-top:8px;
  line-height:1.35;
  display:-webkit-box;
  -webkit-line-clamp:3;      /* show only first 3 lines */
  line-clamp:3;
  -webkit-box-orient:vertical;
  overflow:hidden;
}

/* When expanded via the button, show full text */
.desc.is-expanded{
  -webkit-line-clamp:unset;
  line-clamp:unset;
  display:block;
  overflow:visible;
}

.read-more{
  margin-top:4px;
  border:none;
  background:none;
  padding:0;
  font-size:12px;
  color:var(--accent-2);
  cursor:pointer;
  text-decoration:underline;
}
.read-more:hover{
  text-decoration:none;
}
.save-btn{
  position:absolute; top:10px; right:12px;
  border:none; background:transparent; cursor:pointer;
  font-size:18px; color:#9ca3af;
}
.save-btn.is-on{ color:var(--accent-2); }

/* gallery */
.gallery{ margin-top:8px; overflow-x:auto; white-space:nowrap; border-radius:10px; }
.gallery img{
  height:88px;
  width:110px;
  object-fit:cover;
  display:inline-block;
  margin-right:6px;
  border-radius:10px;
  border:1px solid var(--card-border);
}

/* chips */
.chips{ display:flex; gap:6px; flex-wrap:wrap; margin-top:8px; }
.chip{
  display:inline-flex; align-items:center; justify-content:center;
  gap:6px; font-size:12px; padding:4px 8px; border-radius:999px;
  background:var(--chip-bg); color:var(--chip-text); border:1px solid var(--card-border);
  min-width:28px; min-height:24px; user-select:none;
}
.chip b{ font-weight:600; }
.chip--amen{ border-color:var(--amen-border); background:var(--amen-bg); }
.chip--serv{ border-color:var(--serv-border); background:var(--serv-bg); }

.legend{
  display:flex; gap:8px; align-items:center; margin:8px 12px 0 12px; font-size:12px; color:var(--muted);
}
.legend .dot{ width:10px; height:10px; border-radius:50%; display:inline-block; }
.legend .dot.amen{ background:var(--amen-border); opacity:.6; }
.legend .dot.serv{ background:var(--serv-border); opacity:.6; }
.legend .dot.poi { background:#9ca3af; opacity:.6; }

.link{ margin-top:8px; font-size:13px; }
.link a{
  color:var(--accent-2);
  text-decoration:none;
}
.link a:hover{
  text-decoration:underline;
}
.empty{ color:var(--muted); font-size:13px; padding:14px; margin:12px; border:1px dashed var(--card-border); border-radius:10px; background:var(--card); }

/* decision strip under address */
.decision{
  margin-top:4px;
  font-size:12px;
  color:var(--text);
  font-weight:500;
}

/* room summary (“Rooms from …”) */
.room-summary{
  margin-top:10px;
  padding-top:8px;
  border-top:1px dashed var(--card-border);
  font-size:13px;
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  gap:6px;
}
.room-summary-label{
  display:inline-flex;
  align-items:center;
  gap:4px;
  font-weight:600;
}
.room-summary-price{
  font-weight:600;
}
.room-summary-meta{
  font-size:12px;
  color:var(--muted);
}

/* campus markers */
.pin--uni{ outline:2px solid #f9731622; }

/* pressed state for toggle pills */
button.pill[aria-pressed="true"],
button.pill-ghost[aria-pressed="true"]{
  background:var(--accent);
  color:#ffffff;
  border-color:var(--accent);
}

/* detail panel (future use) */
.detail-panel{
  display:block;
  padding:10px 12px;
  border-bottom:1px solid var(--card-border);
  background:var(--card);
}
.detail-panel[hidden]{ display:none; }

/* Mapbox popups honor theme */
.mapboxgl-popup{
  z-index:10 !important;      /* ensure popup sits above markers */
}
.mapboxgl-popup-content{
  background:var(--popup-bg) !important;
  color:var(--popup-text) !important;
  max-width:340px;            /* matches your JS maxWidth */
  max-height:340px;           /* prevent giant popups */
  overflow:auto;              /* scroll if content is tall */
}
.mapboxgl-popup-tip{
  border-top-color:var(--popup-bg) !important;
  border-bottom-color:var(--popup-bg) !important;
}

/* Popup image: fixed height with cover so it doesn’t crop awkwardly */
.popup-img{
  display:block;
  width:100%;
  height:180px;               /* tweak to taste (160–220px works well) */
  object-fit:cover;
  border-radius:10px;
  margin-bottom:6px;
  border:1px solid var(--card-border);
}

/* Tooltip */
.tt{
  position:fixed; z-index:9999; pointer-events:none;
  background:var(--tt-bg);
  color:var(--tt-text);
  border:1px solid var(--tt-border);
  padding:6px 10px;
  border-radius:10px;
  box-shadow:var(--tt-shadow);
  font-size:13px;
  max-width:260px;
  line-height:1.35;
}

/* Floating action buttons (mobile); hidden on desktop below */
.fab{
  position:absolute;
  /* +24px lift to clear Android gesture bar; still honours safe area */
  bottom:calc(36px + env(safe-area-inset-bottom, 0px));
  width:48px; height:48px; border-radius:50%;
  border:none; background:#111827; color:#fff;
  box-shadow:0 8px 24px rgba(0,0,0,.25);
  font-size:22px; cursor:pointer; z-index:6;
}
#toggleChat{ left:12px; }
#toggleList{ right:12px; }

/* Mobile/Tablet sheet header (hidden on desktop) */
.sheet-header{
  display:none; /* visible on mobile/tablet via media query */
  position:sticky; top:0; z-index:2;
  background:var(--bg);
  border-bottom:1px solid var(--card-border);
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 12px;
}
.sheet-title{ font-weight:600; font-size:14px; }
.sheet-close{
  border:none; background:transparent; font-size:18px; line-height:1;
  color:var(--muted); cursor:pointer;
}

/* ===== Mobile & Tablet ≤1023px: bottom sheets + full-screen map ===== */
@media (max-width:1023px){
  #map{ flex:1; position:relative; }

  /* Panels become bottom sheets */
  #botPane,
  #listPane{
    position:absolute;
    left:0; right:0;
    height:72dvh;
    bottom:-100%;
    background:var(--bg);
    border:1px solid var(--card-border);
    border-bottom:none;
    border-radius:16px 16px 0 0;
    box-shadow:0 -16px 40px rgba(0,0,0,.35);
    transition:bottom .28s ease;
    z-index:5;
    overflow:auto;
  }
  #botPane.active,
  #listPane.active{ bottom:0; }

  /* Ignore desktop widths on mobile */
  #botPane{ width:auto; min-width:0; }
  #listPane{ width:auto; min-width:0; max-width:none; }

  /* Show the sheet header on mobile/tablet */
  .sheet-header{ display:flex; }

  /* Keep filter bar sticky inside list sheet */
  #filtersBar{ position:sticky; top:0; z-index:1; }

  /* Optional: dim map when a sheet is open */
  #map::after{
    content:"";
    position:absolute; inset:0;
    background:transparent;
    transition:background .2s ease;
    pointer-events:none;
    z-index:1;
  }
  #botPane.active ~ #map::after,
  #listPane.active ~ #map::after{
    background:rgba(0,0,0,.12);
  }
}

/* ===== Desktop ≥1024px: original 3-pane layout ===== */
@media (min-width:1024px){
  /* Keep existing widths/behaviour */
  #botPane { width:28vw; min-width:320px; overflow:auto; }
  #listPane{ width:25vw; min-width:300px; max-width:480px; overflow:auto; }

  /* FABs hidden on desktop */
  .fab{ display:none; }

  /* Hide mobile sheet header on desktop (your panels already have context) */
  .sheet-header{ display:none; }
}